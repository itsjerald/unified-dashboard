<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unified Dashboard</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">

  <!-- âœ… Tailwind configuration BEFORE CDN -->
  <script>
    window.tailwind = {
      config: {
        darkMode: 'class',
      },
    };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- âœ… Apply saved theme before paint -->
  <script>
    if (
      localStorage.theme === "dark" ||
      (!("theme" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches)
    ) {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }

    function toggleDarkMode() {
      const html = document.documentElement;
      const isDark = html.classList.toggle("dark");
      localStorage.theme = isDark ? "dark" : "light";
      const btn = document.getElementById("themeToggle");
      if (btn) btn.textContent = isDark ? "â˜€ï¸" : "ğŸŒ™";
    }

    window.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("themeToggle");
      if (btn) btn.textContent = document.documentElement.classList.contains("dark") ? "â˜€ï¸" : "ğŸŒ™";
    });
  </script>
</head>

<body class="bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-200">

  <!-- âœ… Sidebar -->
  <div class="flex h-screen overflow-hidden">
    <aside id="sidebar" class="bg-gray-800 text-white dark:bg-gray-900 dark:text-gray-100 w-64 flex-shrink-0 hidden md:block">
      <div class="p-4 text-lg font-semibold border-b border-gray-700 flex justify-between items-center">
        ğŸ’° Dashboard
          <button id="themeToggle" onclick="toggleDarkMode()">ğŸŒ™</button>
      </div>
      <nav class="p-4 space-y-2 text-sm">
        <button onclick="showSection('home')" class="nav-btn">ğŸ  Home</button>
        <button onclick="showSection('upload')" class="nav-btn">â¬†ï¸ Upload</button>
        <button onclick="showSection('summary')" class="nav-btn">ğŸ“‹ Summary</button>
        <button onclick="showSection('charts')" class="nav-btn">ğŸ“Š Charts</button>
        <button onclick="showSection('transactions')" class="nav-btn">ğŸ’µ Transactions</button>
        <button onclick="showSection('review')" class="nav-btn">ğŸ•µï¸ Review & Share</button>
        <hr class="border-gray-700 my-3">
        <button onclick="showSection('admin')" class="nav-btn">ğŸ›  Admin Dashboard</button>
        <button onclick="showSection('pendingDeletions')" class="nav-btn" id="pendingDeletionsTab" style="display:none;">ğŸ—‚ Pending Deletions</button>
        <button onclick="showSection('categories')" class="nav-btn">ğŸ“‚ Categories & Rules</button>
        <button onclick="showSection('users')" id="usersTab" class="nav-btn hidden">ğŸ‘¥ Users</button>
        <hr class="border-gray-700 my-3">
        <button onclick="logout()" class="nav-btn text-red-400">ğŸšª Logout</button>

      </nav>
    </aside>

    <!-- âœ… Mobile topbar -->
    <div class="md:hidden fixed top-0 left-0 right-0 bg-gray-800 dark:bg-gray-900 text-white flex justify-between items-center p-3 z-10">
      <div class="text-lg font-semibold">ğŸ’° Dashboard</div>
      <div class="flex gap-2 items-center">
        <button onclick="toggleDarkMode()" title="Dark Mode">ğŸŒ™</button>
        <button onclick="toggleSidebar()" class="text-xl">â˜°</button>
      </div>
    </div>

    <!-- âœ… Main Content -->
    <main class="flex-1 overflow-y-auto p-4 md:p-6 mt-10 md:mt-0">
      <!-- General User Sections -->
      <section id="home" class="page">
        <h2 class="text-xl font-semibold mb-3">Welcome</h2>
        <p>Use the sidebar to navigate. Dark mode and responsive layout are enabled.</p>
      </section>

      <section id="upload" class="page hidden">
        <h2 class="text-xl font-semibold mb-3">Upload Transactions</h2>
        <input type="file" id="fileInput" class="border p-2 rounded dark:bg-gray-700 dark:border-gray-600">
        <button onclick="uploadFile()" class="ml-2 bg-blue-600 text-white px-4 py-2 rounded">Upload</button>
        <div id="uploadResult" class="mt-3 text-sm"></div>
      </section>

      <section id="summary" class="page hidden">
        <h2 class="text-xl font-semibold mb-3">Weekly Summary</h2>
        <div id="summaryBox" class="text-sm"></div>
      </section>

      <!-- âœ… Charts Section with Tabs -->
      <section id="charts" class="page hidden">
        <h2 class="text-xl font-semibold mb-4">Spending Charts</h2>

        <div class="flex space-x-2 mb-4">
          <button class="tab-btn active" data-tab="daily">Daily</button>
          <button class="tab-btn" data-tab="monthly">Monthly</button>
          <button class="tab-btn" data-tab="category">Category</button>
        </div>

        <div id="chart-daily" class="chart-tab"><canvas id="dailyChart"></canvas></div>
        <div id="chart-monthly" class="chart-tab hidden"><canvas id="monthlyChart"></canvas></div>
        <div id="chart-category" class="chart-tab hidden"><canvas id="categoryChart"></canvas></div>
      </section>

      <section id="transactions" class="page hidden">
        <h2 class="text-xl font-semibold mb-3">All Transactions</h2>
        <table class="w-full border text-sm dark:border-gray-700">
          <thead class="bg-gray-100 dark:bg-gray-800">
            <tr><th class="border px-2 py-1">Date</th><th class="border px-2 py-1">Merchant</th><th class="border px-2 py-1">Amount</th></tr>
          </thead>
          <tbody id="txnTable"></tbody>
        </table>
      </section>

      <!-- âœ… Admin Sections -->
      <section id="admin" class="page hidden">
        <h2 class="text-xl font-semibold mb-3">Admin System Overview</h2>
        <div id="adminStats" class="text-sm"></div>
      </section>
      <section id="pendingDeletions" class="page hidden">
      <h2 class="text-xl font-semibold mb-3">Pending Deletion Requests</h2>
      <table class="w-full border text-sm dark:border-gray-700">
        <thead class="bg-gray-100 dark:bg-gray-800">
          <tr>
            <th class="border px-2 py-1">Type</th>
            <th class="border px-2 py-1">ID</th>
            <th class="border px-2 py-1">Requested By</th>
            <th class="border px-2 py-1">Approvals</th>
            <th class="border px-2 py-1">Status</th>
            <th class="border px-2 py-1">Actions</th>
          </tr>
        </thead>
        <tbody id="deletionTable"></tbody>
      </table>
    </section>


      <section id="categories" class="page hidden">
        <h2 class="text-xl font-semibold mb-3">Manage Categories</h2>

        <!-- Add Category -->
        <div class="flex mb-3 gap-2">
          <input id="catName" placeholder="New category name" class="border p-2 flex-1 rounded dark:bg-gray-700 dark:border-gray-600">
          <button onclick="createCategory()" class="bg-green-600 text-white px-4 py-2 rounded">Add</button>
        </div>

        <!-- Category Table -->
        <table class="w-full border text-sm mb-4 dark:border-gray-700">
          <thead class="bg-gray-100 dark:bg-gray-800">
            <tr><th class="border px-2 py-1">ID</th><th class="border px-2 py-1">Category</th><th class="border px-2 py-1">Delete</th></tr>
          </thead>
          <tbody id="catTable"></tbody>
        </table>

        <hr class="my-4 border-gray-700">

        <!-- Merchant Rules -->
        <h3 class="text-lg font-semibold mb-2">Merchant Rules</h3>
        <div class="flex mb-3 gap-2">
          <input id="pattern" placeholder="Pattern e.g. MEDPLUS" class="border p-2 flex-1 rounded dark:bg-gray-700 dark:border-gray-600">
          <select id="categorySelect" class="border p-2 rounded flex-1 dark:bg-gray-700 dark:border-gray-600"></select>
          <button onclick="createRule()" class="bg-blue-600 text-white px-4 py-2 rounded">Add Rule</button>
        </div>

        <table class="w-full border text-sm dark:border-gray-700">
          <thead class="bg-gray-100 dark:bg-gray-800">
            <tr><th class="border px-2 py-1">Pattern</th><th class="border px-2 py-1">Category</th><th class="border px-2 py-1">Delete</th></tr>
          </thead>
          <tbody id="rulesTable"></tbody>
        </table>
      </section>

              <section id="users" class="page hidden">
        <h2 class="text-xl font-semibold mb-3">User Management</h2>

        <!-- Add User -->
        <div class="flex mb-3 gap-2">
          <input id="newUserEmail" placeholder="Email" class="border p-2 flex-1 rounded dark:bg-gray-700 dark:border-gray-600">
          <input id="newUserPassword" type="password" placeholder="Password" class="border p-2 flex-1 rounded dark:bg-gray-700 dark:border-gray-600">
          <select id="newUserRole" class="border p-2 rounded dark:bg-gray-700 dark:border-gray-600">
            <option value="user">User</option>
            <option value="admin">Admin</option>
          </select>
          <button onclick="createUser()" class="bg-blue-600 text-white px-4 py-2 rounded">Create</button>
        </div>

        <!-- User Table -->
        <table class="w-full border text-sm dark:border-gray-700">
          <thead class="bg-gray-100 dark:bg-gray-800">
            <tr><th class="border px-2 py-1">Email</th><th class="border px-2 py-1">Role</th><th class="border px-2 py-1">First Login</th></tr>
          </thead>
          <tbody id="usersTable"></tbody>
        </table>
      </section>

        <section id="review" class="page hidden">
  <h2 class="text-xl font-semibold mb-3">Review Uploaded Transactions</h2>
  <table class="w-full border text-sm dark:border-gray-700 mb-4">
    <thead class="bg-gray-100 dark:bg-gray-800">
      <tr>
        <th class="border px-2 py-1">Date</th>
        <th class="border px-2 py-1">Merchant</th>
        <th class="border px-2 py-1">Amount</th>
        <th class="border px-2 py-1">Category</th>
        <th class="border px-2 py-1">Delete</th>
        <th class="border px-2 py-1">Select</th>
      </tr>
    </thead>
    <tbody id="reviewTable"></tbody>
  </table>
  <div class="flex items-center gap-3">
    <label for="parentSelect" class="text-sm font-medium">Share With Parent:</label>
    <select id="parentSelect" class="border rounded dark:bg-gray-700 dark:border-gray-600"></select>
    <button onclick="shareSelected()" class="bg-blue-600 text-white px-4 py-2 rounded">Share</button>
    <button onclick="showSection('home')" class="bg-gray-600 text-white px-4 py-2 rounded">Share Later</button>
  </div>
  <div id="shareResult" class="mt-3 text-sm"></div>
</section>

    </main>
  </div>

  <!-- âœ… Scripts -->
  <script>
    // Sidebar toggle
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('hidden');
    }

    // Dark mode toggle
    function toggleDarkMode() {
    const html = document.documentElement;
    const isDark = html.classList.toggle('dark');
    localStorage.theme = isDark ? 'dark' : 'light';

    // Update the icon dynamically
    const btn = document.getElementById('themeToggle');
    if (btn) btn.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
  }

  // Sync button icon on load
  window.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('themeToggle');
    if (btn) btn.textContent = document.documentElement.classList.contains('dark') ? 'â˜€ï¸' : 'ğŸŒ™';
  });

    // Show page
    function showSection(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('bg-gray-700'));
      event?.target?.classList?.add('bg-gray-700');
      if (window.innerWidth < 768) document.getElementById('sidebar').classList.add('hidden');
      if (id === 'summary') loadSummary();
      if (id === 'charts') loadCharts();
      if (id === 'transactions') loadTransactions();
      if (id === 'admin') loadAdmin();
      if (id === 'categories') { loadCategories(); loadRules(); }
      if (id === 'users') loadUsers();
    }

    // Upload
    async function uploadFile() {
      const f = document.getElementById('fileInput').files[0];
      if (!f) return alert("Select a file first");
      const fd = new FormData();
      fd.append("file", f);
      const res = await fetch("/api/upload", { method: "POST", body: fd, credentials: "include" });
      const j = await res.json();
      document.getElementById("uploadResult").innerHTML = `âœ… Imported: ${j.imported}, Duplicates: ${j.duplicates}`;
    }

    // Summary
    async function loadSummary() {
      const res = await fetch("/api/summary", { credentials: "include" });
      if (res.status === 401) {
        window.location.href = "/login.html";
        return;
      }
      const j = await res.json();
      document.getElementById("summaryBox").innerHTML = `
        <p>Total: <b>${j.total}</b></p>
        <ul>${j.unpaid.map(u => `<li>${u.date.split('T')[0]} - ${u.merchant} - â‚¹${u.amount}</li>`).join('')}</ul>
      `;
    }


    // Charts with Tabs
   let dailyChartInstance, monthlyChartInstance, categoryChartInstance;
   async function loadCharts() {
  const [daily, monthly, category] = await Promise.all([
    fetch("/api/report/daily", { credentials: "include" }).then(r => r.json()),
    fetch("/api/report/monthly", { credentials: "include" }).then(r => r.json()),
    fetch("/api/report/category", { credentials: "include" }).then(r => r.json())
  ]);

  // âœ… Destroy old charts if they exist
  if (dailyChartInstance) dailyChartInstance.destroy();
  if (monthlyChartInstance) monthlyChartInstance.destroy();
  if (categoryChartInstance) categoryChartInstance.destroy();

  dailyChartInstance = new Chart(document.getElementById("dailyChart"), {
    type: "line",
    data: {
      labels: daily.map(d => d.date),
      datasets: [{ label: "Daily Spend", data: daily.map(d => d.total) }]
    }
  });

  monthlyChartInstance = new Chart(document.getElementById("monthlyChart"), {
    type: "bar",
    data: {
      labels: monthly.map(d => d.month),
      datasets: [{ label: "Monthly Spend", data: monthly.map(d => d.total) }]
    }
  });

  categoryChartInstance = new Chart(document.getElementById("categoryChart"), {
    type: "pie",
    data: {
      labels: category.map(c => c.category),
      datasets: [{ label: "By Category", data: category.map(c => c.total) }]
    }
  });
}


    // Chart Tabs switcher
    document.addEventListener('click', e => {
      if (e.target.classList.contains('tab-btn')) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        const tab = e.target.dataset.tab;
        document.querySelectorAll('.chart-tab').forEach(t => t.classList.add('hidden'));
        document.getElementById(`chart-${tab}`).classList.remove('hidden');
      }
    });

    async function loadTransactions() {
      const txns = await fetch("/api/transactions", { credentials: "include" }).then(r => r.json());
      document.getElementById("txnTable").innerHTML = txns.map(t =>
        `<tr><td class="border px-2 py-1">${t.date.split('T')[0]}</td><td class="border px-2 py-1">${t.merchant}</td><td class="border px-2 py-1">â‚¹${t.amount}</td></tr>`
      ).join('');
    }

    async function loadAdmin() {
      const res = await fetch("/api/admin/system", { credentials: "include" });

      if (res.status === 403) {
        document.getElementById("adminStats").innerHTML =
          `<p class="text-red-500">âš ï¸ Access denied. Only admins can view this section.</p>`;
        return;
      }

      if (!res.ok) {
        document.getElementById("adminStats").innerHTML =
          `<p class="text-red-500">âš ï¸ Failed to load system stats.</p>`;
        return;
      }

      const j = await res.json();
      document.getElementById("adminStats").innerHTML = `
        <p>Users: <b>${j.total_users}</b></p>
        <p>Transactions: <b>${j.total_txn}</b></p>
        <p>Unpaid: <b>${j.total_unpaid}</b></p>
      `;
    }


    async function loadCategories() {
      const cats = await fetch("/api/admin/categories", { credentials: "include" }).then(r => r.json());
      const tbody = document.getElementById("catTable");
      const sel = document.getElementById("categorySelect");
      tbody.innerHTML = "";
      sel.innerHTML = "";
      cats.forEach(c => {
        tbody.innerHTML += `<tr><td class="border px-2 py-1">${c.id}</td><td class="border px-2 py-1">${c.name}</td><td class="border px-2 py-1"><button onclick="deleteCategory(${c.id})" class="bg-red-500 text-white px-2 py-1 rounded">Delete</button></td></tr>`;
        sel.innerHTML += `<option value="${c.id}">${c.name}</option>`;
      });
    }

    async function createCategory() {
      const name = document.getElementById("catName").value;
      if (!name.trim()) return alert("Enter category name");
      await fetch("/api/admin/categories", { method: "POST", credentials: "include", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ name }) });
      loadCategories();
    }

    async function deleteCategory(id) {
      if (!confirm("Delete this category?")) return;
      await fetch(`/api/admin/categories/${id}`, { method: "DELETE", credentials: "include" });
      loadCategories();
    }

    async function loadRules() {
      const rules = await fetch("/api/admin/merchant-rules", { credentials: "include" }).then(r => r.json());
      const tbody = document.getElementById("rulesTable");
      tbody.innerHTML = "";
      rules.forEach(r => {
        tbody.innerHTML += `<tr><td class="border px-2 py-1">${r.pattern}</td><td class="border px-2 py-1">${r.category}</td><td class="border px-2 py-1"><button onclick="deleteRule(${r.id})" class="bg-red-500 text-white px-2 py-1 rounded">Delete</button></td></tr>`;
      });
    }

    async function createRule() {
      const pattern = document.getElementById("pattern").value;
      const cat = document.getElementById("categorySelect").value;
      await fetch("/api/admin/merchant-rules", { method: "POST", credentials: "include", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ pattern, category_id: cat }) });
      loadRules();
    }

    async function deleteRule(id) {
      await fetch(`/api/admin/merchant-rules/${id}`, { method: "DELETE", credentials: "include" });
      loadRules();
    }
    // âœ… Check login + role on load
    async function checkLogin() {
      const res = await fetch("/auth/me", { credentials: "include" });
      const user = await res.json();

      if (!user.authenticated) {
        window.location.href = "/login.html"; // Redirect if not logged in
        return;
      }

       // âœ… Inside checkLogin(), after verifying authenticated:
        if (user.first_login) {
          window.location.href = "/change-password.html";
          return;
        }

        if (user.role === "admin") {
              document.getElementById("usersTab").classList.remove("hidden");
        }
        else if (user.role === "superadmin") {
          document.getElementById("pendingDeletionsTab").style.display = "";
        }
        else {
          // Hide admin-only buttons for normal users
          document.querySelector("button[onclick=\"showSection('admin')\"]").classList.add("hidden");
          document.querySelector("button[onclick=\"showSection('categories')\"]").classList.add("hidden");
        }
    }

    // âœ… Load all users (for admin)
    async function loadUsers() {
      const res = await fetch("/auth/admin/users", { credentials: "include" })
      if (res.status === 401) {
        window.location.href = "/login.html";
        return;
      }
      const users = await res.json();
      const tbody = document.getElementById("usersTable");
      tbody.innerHTML = "";
      users.forEach(u => {
        tbody.innerHTML += `
          <tr>
            <td class="border px-2 py-1">${u.email}</td>
            <td class="border px-2 py-1">${u.role}</td>
            <td class="border px-2 py-1">${u.first_login}</td>
          </tr>`;
      });
    }

    // âœ… Create new user
    async function createUser() {
      const email = document.getElementById("newUserEmail").value.trim();
      const password = document.getElementById("newUserPassword").value.trim();
      const role = document.getElementById("newUserRole").value;

      if (!email || !password) {
        alert("Please fill in both email and password.");
        return;
      }

      const res = await fetch("/auth/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify({ email, password, role })
      });

      if (res.status === 401) {
        alert("Session expired. Please login again.");
        window.location.href = "/login.html";
        return;
      }

      if (!res.ok) {
        const err = await res.json();
        alert("Error: " + (err.detail || "Could not create user"));
        return;
      }

      alert("âœ… User created successfully!");
      document.getElementById("newUserEmail").value = "";
      document.getElementById("newUserPassword").value = "";
      await loadUsers();
    }

    async function logout() {
      await fetch("/auth/logout", { method: "POST", credentials: "include" });
      window.location.href = "/login.html";
    }


      async function loadReviewTable() {
      // Get current user's unshared uploaded transactions
      const txns = await fetch("/api/transactions/pending_review", { credentials: "include" }).then(r => r.json());
      document.getElementById("reviewTable").innerHTML = txns.map(t =>
        `<tr>
          <td class="border px-2 py-1">${t.date.split('T')[0]}</td>
          <td class="border px-2 py-1">${t.merchant ?? ''}</td>
          <td class="border px-2 py-1">â‚¹${t.amount}</td>
          <td class="border px-2 py-1">${t.category ?? ''}</td>
          <td class="border px-2 py-1"><button onclick="deleteTxn(${t.id})" class="bg-red-500 text-white px-2 py-1 rounded">Delete</button></td>
          <td class="border px-2 py-1"><input type="checkbox" class="share-checkbox" value="${t.id}"></td>
        </tr>`
      ).join('');
    }

    async function deleteTxn(id) {
      if (!confirm("Delete this transaction?")) return;
      await fetch(`/api/transactions/${id}`, { method: "DELETE", credentials: "include" });
      loadReviewTable();
    }

    // Fetch possible parents (admins in your family)
    async function loadParentSelect() {
      const res = await fetch("/api/users/parents", { credentials: "include" });
      const parents = await res.json();
      const sel = document.getElementById("parentSelect");
      sel.innerHTML = parents.map(p =>
        `<option value="${p.id}">${p.email}</option>`
      ).join('');
    }

    async function shareSelected() {
      const ids = Array.from(document.querySelectorAll('.share-checkbox:checked')).map(cb => Number(cb.value));
      const parentId = document.getElementById("parentSelect").value;
      if (!ids.length) return alert("Select at least one transaction.");
      const res = await fetch("/api/transactions/share", {
        method: "POST",
        credentials: "include",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ ids, parent_id: parentId })
      });
      const result = await res.json();
      document.getElementById("shareResult").textContent = `âœ… Shared ${result.shared.length} transactions with parent.`;
      loadReviewTable();
    }

    document.addEventListener('DOMContentLoaded', () => {
      // Load table & parent options when section is shown
      document.querySelector('button[onclick="showSection(\'review\')"]').addEventListener('click', () => {
        loadReviewTable();
        loadParentSelect();
        document.getElementById("shareResult").textContent = "";
      });
    });



    // Load pending deletions
    async function loadPendingDeletions() {
      const res = await fetch("/api/admin/pending_deletions", { credentials: "include" });
      if (!res.ok) {
        document.getElementById("deletionTable").innerHTML = '<tr><td colspan="6" class="text-center text-red-500">Access denied or error loading requests.</td></tr>';
        return;
      }
      const deletions = await res.json();
      document.getElementById("deletionTable").innerHTML =
        deletions.length === 0
        ? '<tr><td colspan="6" class="text-center">No pending requests.</td></tr>'
        : deletions.map(d =>
          `<tr>
            <td class="border px-2 py-1">${d.entity_type}</td>
            <td class="border px-2 py-1">${d.entity_id}</td>
            <td class="border px-2 py-1">${d.requested_by_email}</td>
            <td class="border px-2 py-1">${d.approval_emails ? d.approval_emails.join(', ') : ''}</td>
            <td class="border px-2 py-1">${d.executed ? '<span class="text-green-600">Completed</span>' : 'Pending'}</td>
            <td class="border px-2 py-1">
              ${!d.executed && d.can_approve
                ? `<button onclick="approveDelete(${d.id})" class="bg-blue-600 text-white px-2 py-1 rounded mr-2">Approve</button>`
                : ''}
            </td>
          </tr>`
        ).join('');
    }

    async function approveDelete(id) {
      if (!confirm("Approve this deletion?")) return;
      const res = await fetch(`/api/admin/approve_delete/${id}`, {
        method: "POST",
        credentials: "include"
      });
      if (res.ok) {
        alert("Approval registered.");
        loadPendingDeletions();
      } else {
        const err = await res.json().catch(() => ({}));
        alert("Error: " + (err.detail || "Could not approve"));
      }
    }


    checkLogin();
    showSection("home");
  </script>

  <style>
    .nav-btn {
      width: 100%;
      text-align: left;
      display: block;
      padding: 0.5rem 0.75rem;
      border-radius: 0.375rem;
      transition: background 0.2s;
    }
    .nav-btn:hover { background-color: #374151; }
    .tab-btn {
      padding: 6px 12px;
      border-radius: 6px;
      background: #e5e7eb;
      font-size: 0.875rem;
    }
    .tab-btn.active {
      background: #2563eb;
      color: white;
    }
    .dark .tab-btn { background: #374151; color: #d1d5db; }
    .dark .tab-btn.active { background: #2563eb; color: white; }
      @media (max-width: 768px) {
      .nav-btn { padding: 0.4rem 0.5rem; font-size: 0.9rem; }
      .page h2 { font-size: 1rem; }
      main { padding-top: 3.5rem; }
    }
  </style>
</body>
</html>
